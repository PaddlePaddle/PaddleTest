#!/bin/env python3
# -*- coding: utf-8 -*-
# @author DDDivano
# encoding=utf-8 vi:ts=4:sw=4:expandtab:ft=python


from dist_tester import Runner
import time

def test_double_mnist():
    """
    测试双卡MNIST 数据并行策略
    """
    expect = {'gpu0': [2.293632984161377, 0.35192984342575073, 0.17196156084537506, 0.16533605754375458, 0.2342698872089386, 0.4348629415035248, 0.18082061409950256, 0.23593638837337494, 0.20108294486999512, 0.20455004274845123], 'gpu1': [2.3047142028808594, 0.8675868511199951, 0.566219687461853, 0.6229428052902222, 0.4143543541431427, 0.37661972641944885, 0.24119853973388672, 0.6879538297653198, 0.5368596315383911, 0.49480146169662476]}
    r = Runner(case_file="dist_mnist_GS.py", gpus="0,1", expect=expect)
    r.run()
    time.sleep(10)

def test_quadra_mnist():
    """
    4 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.44317612051963806, 0.24180030822753906, 0.22939741611480713, 0.22970224916934967], 'gpu1': [2.3047142028808594, 2.2705330848693848, 2.2378482818603516, 2.0813114643096924, 2.1134958267211914], 'gpu2': [2.2227988243103027, 0.9130821228027344, 0.6795603036880493, 0.4479982852935791, 0.6244199872016907], 'gpu3': [2.285763740539551, 2.3407247066497803, 2.4313178062438965, 2.3214375972747803, 2.326948642730713]}
    r = Runner(case_file="dist_mnist_GS.py", gpus="0,1,2,3", expect=expect)
    r.run()
    time.sleep(10)

def test_hexa_mnist():
    """
    6 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.4033816158771515, 0.27147167921066284, 0.3860296607017517], 'gpu1': [2.3047142028808594, 2.25860857963562, 2.202958583831787, 2.161378860473633], 'gpu2': [2.2227988243103027, 0.9927545189857483, 0.5451534986495972, 0.7451518774032593], 'gpu3': [2.285763740539551, 2.4278016090393066, 2.2986016273498535, 2.2984237670898438], 'gpu4': [2.463984489440918, 2.4549593925476074, 2.3943185806274414, 2.4101004600524902], 'gpu5': [2.4113454818725586, 2.3764865398406982, 2.278918743133545, 2.410250186920166]}
    r = Runner(case_file="dist_mnist_GS.py", gpus="0,1,2,3,4,5", expect=expect)
    r.run()
    time.sleep(10)

def test_octa_mnist():
    """
    8 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.34160298109054565, 0.33811190724372864], 'gpu1': [2.3047142028808594, 2.3179373741149902, 2.1446728706359863], 'gpu2': [2.2227988243103027, 1.0148149728775024, 0.7885985374450684], 'gpu3': [2.285763740539551, 2.48054838180542, 2.3603811264038086], 'gpu4': [2.463984489440918, 2.330746650695801, 2.312662124633789], 'gpu5': [2.4113454818725586, 2.328458547592163, 2.289884090423584], 'gpu6': [2.255356788635254, 2.430631637573242, 2.3036890029907227], 'gpu7': [2.3492424488067627, 2.270418405532837, 2.3453733921051025]}
    r = Runner(case_file="dist_mnist_GS.py", gpus="0,1,2,3,4,5,6,7", expect=expect)
    r.run()
    time.sleep(10)
