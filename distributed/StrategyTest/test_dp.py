#!/bin/env python3
# -*- coding: utf-8 -*-
# @author DDDivano
# encoding=utf-8 vi:ts=4:sw=4:expandtab:ft=python


from dist_tester import Runner

def test_double_mnist():
    """
    测试双卡MNIST 数据并行策略
    """
    expect = {'gpu0': [2.293632984161377, 0.36290404200553894, 0.1479448676109314, 0.1155368834733963,
                       0.14024101197719574, 0.4891274869441986, 0.1502114236354828, 0.20055055618286133,
                       0.22123681008815765, 0.17345929145812988],
              'gpu1': [2.3047142028808594, 0.150826096534729, 0.18604284524917603, 0.3431836664676666,
                       0.13851872086524963, 0.14630866050720215, 0.1568116992712021, 0.28892526030540466,
                       0.2789202332496643, 0.22205016016960144]}
    r = Runner(case_file="dist_mnist.py", gpus="0,1", expect=expect)
    r.run()


def test_quadra_mnist():
    """
    4 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.19743755459785461, 0.1582164466381073, 0.13118807971477509, 0.18831941485404968], 'gpu1': [2.3047142028808594, 0.2161804437637329, 0.19434219598770142, 0.05129124969244003, 0.2578509449958801], 'gpu2': [2.2227988243103027, 0.16583669185638428, 0.21678447723388672, 0.03125173598527908, 0.35801878571510315], 'gpu3': [2.285763740539551, 0.219307079911232, 0.199639230966568, 0.29571059346199036, 0.14579594135284424]}
    r = Runner(case_file="dist_mnist.py", gpus="0,1,2,3", expect=expect)
    r.run()


def test_hexa_mnist():
    """
    6 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.14981171488761902, 0.1692422479391098, 0.1066637709736824], 'gpu1': [2.3047142028808594, 0.33422136306762695, 0.06589572131633759, 0.3439653515815735], 'gpu2': [2.2227988243103027, 0.12327966094017029, 0.038205716758966446, 0.1264638751745224], 'gpu3': [2.285763740539551, 0.11417204886674881, 0.34553396701812744, 0.2226867377758026], 'gpu4': [2.463984489440918, 0.28501585125923157, 0.03497598320245743, 0.32441431283950806], 'gpu5': [2.4113454818725586, 0.321025550365448, 0.2474701702594757, 0.08864762634038925]}
    r = Runner(case_file="dist_mnist.py", gpus="0,1,2,3,4,5", expect=expect)
    r.run()

def test_octa_mnist():
    """
    8 cards
    """
    expect = {'gpu0': [2.293632984161377, 0.17867982387542725, 0.16567513346672058], 'gpu1': [2.3047142028808594, 0.2219160497188568, 0.16643072664737701], 'gpu2': [2.2227988243103027, 0.2366219013929367, 0.24359455704689026], 'gpu3': [2.285763740539551, 0.16838949918746948, 0.17118826508522034], 'gpu4': [2.463984489440918, 0.13035036623477936, 0.21087785065174103], 'gpu5': [2.4113454818725586, 0.16911916434764862, 0.042866479605436325], 'gpu6': [2.255356788635254, 0.45313581824302673, 0.07524213194847107], 'gpu7': [2.3492424488067627, 0.19972935318946838, 0.0851360335946083]}
    r = Runner(case_file="dist_mnist.py", gpus="0,1,2,3,4,5,6,7", expect=expect)
    r.run()
